namespace :git do
  desc "Perform a sparse checkout of a private Git repository"
  task sparse_checkout: :environment do
    repo_url = "git@github.com:username/private-repo.git" # Change to your repo URL
    target_dir = "private-repo" # Change to your desired target directory
    branch_name = "main" # Change to your desired branch name

    # Step 1: Clone the repository without checking out files
    system("git clone --no-checkout #{repo_url} #{target_dir}")

    # Step 2: Change to the repository directory
    Dir.chdir(target_dir) do
      # Step 3: Enable sparse checkout
      system("git config core.sparseCheckout true")

      # Step 4: Specify the files/directories to checkout
      File.open(".git/info/sparse-checkout", "w") do |file|
        file.puts "src/*" # Change to your desired paths
        file.puts "README.md" # Change to your desired paths
      end

      # Step 5: Checkout the specified files
      system("git checkout #{branch_name}")
    end

    puts "Sparse checkout completed for #{repo_url}."
  end
end
